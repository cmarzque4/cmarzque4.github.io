<html>
  <head>
    <style>
      table{ 
        width:50%; //Ocupa el 50% de l'amplada de la pàgina
        border-collapse: collapse;// Evita que apareixin dobles linies a les cel·les 
        margin: 20px auto;} //Marge de 20px a la part superior i centra la taula
      
      th,td{
        border: 1px solid #ddd; //Afegieix una vora fina d'un píxel de color gris clar al voltant de totes les cel·les th i td.
        padding: 10px auto; //Espai intern dins de cada cel·la, per fer-la més llegible.
        text-algin: center} //Centrar el text dins de cada cel·la.
        
      thead{
        background: #f4f4f4; //Cavia el color del fons del thead a gris clar.
        font-weight: bold;} //Fa que la capçelera de la aula estigui en negreta.
        
      tbody tr: nth-child(even){ //És una pseudoclasse aplicada a tr segons si es parell o imparell, even és parell i odd és imparell.
        background-color: #f9f9f9;}

      tbody tr: hover{  //És una pseudoclasse hover per quan passo per sobre amb el ratolí pel contngut de la taula és fa més fosc.
        background-color: #e2e2e2;}
    </style>
  </head>
<h1> Conceptes generals de microcontroladors </h1>
<p> Els diferents microcontroladors tenen en comú els seguents aspectes:</p>
<ul>
  <li>Tipus d'entrades i sortides: el microcontrolador té un processador tipus AVR o Espressif on es conecta entrades digitals, entrades analògiques, sortides digitals i sortides analògiques</li>
  <li>Les entrades i sortides digitals només funcionen amb 0 o 1 es a dir codi binari, zero significa 0 volts i 1 pot significar 5 volts o 3,3 volts depenent del microcontrolador i del pin que utilitzem. A aquestes entrades podem connectar per exemple interruptors, sensor "foscor/claror" </li>  
</ul>
<h2> Sortides analògiques tipus PWM</h2>
<p> PWM significa modulació de l'ample de banda, en anglès <i> Pulse Width Modulation</i> i és una forma d'aconseguir una sortida analògica a partir de diverses sortides digitals, molt ràpides.</p>
<p>PWM es representa amb el símbol "~" tal com podem veure a la imatge següent d'un Arduino Uno</p>
<img src="arduino_uno.png" width="600" height="400">
<p>Més amunt podem veure que els pins números 3, 5, 6, 9, 10 i 11</p>
<p> Aquests PWM són sortides analògiques de 8 bits, en el cas d'Arduino Uno Rev3 d'acord amb el <a href="https://store.arduino.cc/en-es/products/arduino-uno-rev3"> fabricant </a>, mentres en el cas d'Arduino Uno Rev4, és de 12 bits segons el <a href="https://docs.arduino.cc/resources/datasheets/ABX00080-datasheet.pdf"> fabricant </a>, que l'anomena DAC, que vol dir Digital Analog Converter</p>
<p> Tenir 8 o 12 bits en un convertidor digital analògic o DAC (Digital Analog Converter) tipus PWM fa que tinguem 2<sup>8</sup> o 2<sup>10</sup> nivells diferents de corrent, és a dir, 256 nivells diferents o 2048 nivells diferents</p>
<p> Soposem que tant Arduino uno Rev3 com Rev4 poden donar 5 volts com a màxim. Quina seria la resolució en milivolts de cada Arduino?</p>
<p> 5 vols dividit entre 256 dona 0.01953125 volts = 19.53125 milivolts per Arduino Uno Rev3</p>
<p> 5 vols dividit entre 2048 dona 0.00244140625 volts = 2.44140625 milivolts per Arduino Uno Rev4</p>
<p>Els milivolts anterior són la resolució que aconseguim. Imaginem que volem regular la  intensitat d'un LED amb un Arduino Uno Rev3 aconseguim menys fluid i amb graons més grans, es a dir canvis més bruscs perque 256 canvis són menys que 2048 volts. A continuació veurem una imatge que repreenta com combinant moltes senyals digitals ràpidament sembla que generem un senyal analògic, aixo és la base del PWM.</p>
<img src="PMW.PNG" widht="600" height="450">
<p>Quan major és l'amplada del pols vol dir que major és el temps que la sortida digital està en voltatge alt, per exemple 5V i menys temps està a 0V, i per tant el promig  de tots els polsos és més alt. En canvi si per exemple si cada pols és més estret a 5V vol dir que estarà més temps a 0V, i per tant el promig  de tots els polsos és més baix. A la imatge de a dalt es pot veure com s'encendria un LED o un motor funcionaria a una velocitat del 0%, 25%, 50%, 75%, 100%. Quin percentatge del senyal canviara en un cas i en un altre?</p>
  <ul>
    <li>(0,01953125/5)*100 = 0,390625%</li>
    <li>(0,00244140625/5)*100 = 0,048828125%</li>
  </ul>  
<p>A la taula a continuació veuras els valors per defecte de la freqüència PWM en Arduino Uno Rev3</p>
<table>
  <thead>
    <tr>
      <th>PIN de Sortida</th><th>Freqüència PWM (Hz)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>PINS: 3, 9, 10 i 11</td>
      <td>490 Hz</td>
    </tr>
    <tr>
      <td>PINS: 5 i 6</td>
      <td>976 Hz</td>
    </tr>
  </tbody>
</table>

<p>Nota: la taula HTML anterior té una capçelera com un document HTML, però és diu thead, en comptes de head i es la primera filera de la taula.
   Té un cos anomenat tbody, en comptes de body i és la resta de la taula. 
   La taula la defineix el tag table que agrupa thead i tbody. Totes les fileres tant del thead com el tbody es defineixen amb el tag tr, que vol dir table row.
   Dintre de thead hi ha ellements indivituals que són cel·les que pertanyen a la primera filera i s'anomenen th o table heading.
   En el table body hi ha també fileres tr però dintre d'aquestes fileres els elements individuals han de ser td, que significa table data. Per últim, s'han de tancar el table o el body.
  Tots aquest elements es poden modificar amb CSS i fer la taula amb unn estil propi.</p>
<p>Les freqüències baixes proueixen soroll en els motors. Per tant és preferible conectar motors als pins 5 i 6.</p>
<p>La freqüència es la inversa del periode, 976 Hz o cicles per segon corespon a un període de 1/976 segons que és igual a 1,024 milisegons</p>
<h2>Convertidor analògic-digtal</h2>
<p>Apliquem el teorema de Nyquist que diu que hem de fer el dole de mostres com a minim que la freqüencia màxima per aconseguirr convertir en senyal analogic contínu anaògic en un senyal digital mostrejat segons la figura següent</p>
<img src="nyquist.jpeg" witgh="600" height="400">
  <p>Nyquist és important, perque si en el codi poso una freq¨`encia de mostreig de 20 Hz per un so, no funcionarà, perque la freqüència mínima del so es de 20 Hz i la màxima 20 kHz, pel que es refereix al so audible en humans. Això es per que agafem mostres massa grans, i no opdem veure pujades i baixades de la senyal</p>
  <p>A continuació veurem una taula comparativa sobre els micrcontroladors Arduino uno i ESP32S3 i el circuit ADS1115</p>
  <table>
    <thead>
      <tr>
        <th>Microcontrolador o circuit</th>
        <th>Número de bits (nivells)</th>
        <th>Voltatge</th>
      </tr>
      <tr>
        <td>Arduino uno</td>
        <td>10 (0-1023)</td>
        <td>0-5V / 0-3.3V</td>
      </tr>
      <tr>
        <td>ESP32S3</td>
        <td>12 (0-4095)</td>
        <td>0-3.3V</td>
      </tr>
      <tr>
        <td>ADS1115</td>
        <td>16 (0-65536)</td>
        <td>0-3.3V</td>
      </tr>
    </thead>
  </table>

  <pre><code>
    int valor_ADC=0;
    void setup(){    //9600 en Arduino
    Serial_begin(9600);  //115200 en S3
    }
    void loop(){
    valor ADC=analogRead(A0)  //34 en S3
    Serial.println(valorADC);  //0-1023
    delay(500);}  //0-4095
  </code></pre>
</body>
</html>
